name: Update SUMMARY.md

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  actions: write
  contents: write
  deployments: write
  pages: write
  pull-requests: write
  repository-projects: write


jobs:
  generate-summary:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        ref: ${{ github.event.pull_request.head.ref }}
        persist-credentials: true

    - name: Generate Summary
      run: |
        cd src
        rm SUMMARY.md
        touch SUMMARY.md
        find . -type f | while read file; do
          filename=$(basename "$file")
          directory=$(dirname "$file" | sed 's/\.\///g' | sed 's/\//  /g')
          directory=$(echo $directory | sed 's/ /  /g' | sed 's/\.$//')
          echo "- $directory[$filename]($file)" >> SUMMARY.md
        done


    - name: Commit and push if changed
      run: |        
        git config --local user.email "actions@github.com"
        git config --local user.name "GitHub Actions"
        git remote set-url origin https://felix-rojas:${{ secrets.BOT }}@github.com/tec-devs-2024/wiki.git
        git add src/SUMMARY.md
        git commit -m "Auto-Update SUMMARY.md" || exit 0
        git push origin ${{ github.event.pull_request.head.ref }} || echo "No changes to push"
